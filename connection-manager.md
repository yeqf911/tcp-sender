# 连接管理模块设计文档

## 概述

连接管理模块用于管理 TCP 连接的生命周期，提供连接配置保存、快速连接、状态监控等功能。

---

## 1. 连接列表管理

### 1.1 连接配置保存
- 保存常用的服务器配置（名称、主机、端口、超时等）
- 支持连接配置的 CRUD 操作
- 配置持久化存储（SQLite 数据库）

**配置字段：**
```typescript
interface ConnectionConfig {
  id: string;
  name: string;
  host: string;
  port: number;
  timeout: number;        // 连接超时（秒）
  keepAlive: boolean;     // 是否保持连接
  autoReconnect: boolean;// 是否自动重连
  reconnectInterval: number; // 重连间隔（毫秒）
  description?: string;  // 描述信息
  tags?: string[];       // 标签（分组）
  createdAt: string;
  updatedAt: string;
}
```

### 1.2 分组/标签管理
- 按项目或环境分组（开发/测试/生产）
- 支持多标签分类
- 标签筛选和搜索

### 1.3 快速连接
- 一键连接到保存的服务器
- 连接状态实时显示
- 支持最近连接历史

---

## 2. 连接生命周期管理

### 2.1 状态管理
- **已连接** (Connected) - 绿色指示
- **断开** (Disconnected) - 灰色指示
- **连接中** (Connecting) - 黄色指示
- **错误** (Error) - 红色指示

### 2.2 自动重连
- 断线后自动重连
- 可配置重连次数和间隔
- 指数退避策略（逐渐增加重连间隔）

### 2.3 心跳检测
- 定期发送心跳包检测连接健康状态
- 可配置心跳间隔
- 超时自动断开并重连

### 2.4 Keep-Alive
- 支持 TCP Keep-Alive
- 可配置保活参数

---

## 3. 批量操作

### 3.1 批量连接
- 同时连接多个服务器
- 显示连接进度

### 3.2 批量断开
- 一键断开所有连接
- 按分组批量断开

### 3.3 群发消息
- 向多个连接发送相同消息
- 支持不同协议模式

### 3.4 批量健康检查
- 对多个服务器进行健康检查
- 显示检查结果汇总

---

## 4. 连接模板

### 4.1 预设模板
- 常用服务器的配置模板
- 内置常见服务端口（HTTP/FTP/SMTP等）

### 4.2 快速复制
- 从现有连接快速创建副本
- 修改参数后保存为新连接

### 4.3 导入/导出
- 导出连接配置为 JSON 文件
- 导入团队共享的连接配置
- 支持批量导入

---

## 5. 监控与日志

### 5.1 实时监控
- 连接状态实时更新
- 流量统计（发送/接收字节数）
- 连接时长统计

### 5.2 连接历史
- 记录连接/断开事件
- 记录错误信息
- 历史数据查询

### 5.3 性能指标
- 平均响应时间
- 消息发送成功率
- 错误率统计

---

## 6. 界面设计

### 6.1 主页面布局
```
┌─────────────────────────────────────────────────────────┐
│  Connections                    [+ New Connection] [Import]│
├─────────────────────────────────────────────────────────┤
│  [Search...]                     [Group: All ▼]  [View: ▼]   │
├─────────────────────────────────────────────────────────┤
│  Name       │ Host:Port    │ Status      │ Actions │Tags │
├─────────────┼─────────────┼────────────┼─────────┼──────┤
│ 🟢 Dev API  │ localhost:8080│ Connected  │ [Send]  │ Dev  │
│             │              │ 1.2KB/s    │ [Edit]  │ API  │
│             │              │ Uptime: 5m  │ [Disconnect]│      │
├─────────────┼─────────────┼────────────┼─────────┼──────┤
│ ⚪ Prod DB  │ 192.168.1.10│ Disconnected│ [Edit]  │ Prod │
│             │ :3306        │             │ [Delete]│ DB   │
└─────────────┴─────────────┴────────────┴─────────┴──────┘
```

### 6.2 连接详情面板
- 连接基本信息
- 实时流量图表
- 连接事件日志
- 快速消息发送区域

---

## 7. 技术实现

### 7.1 后端 (Rust)
- 新增 `ConnectionConfig` 模型
- 扩展 `ConnectionManager` 支持持久化配置
- 实现自动重连和心跳机制
- 添加连接事件日志

### 7.2 前端 (React)
- 新增 `ConnectionManager` 页面
- 实现连接列表组件
- 添加连接配置对话框
- 实现实时状态更新

### 7.3 数据库
- 新增 `connections` 表存储配置
- 新增 `connection_events` 表存储日志
- 新增 `connection_tags` 表支持标签

---

## 8. 功能优先级

### P0 (高优先级)
- [ ] 连接配置保存/加载
- [ ] 连接列表显示
- [ ] 快速连接/断开
- [ ] 连接状态实时显示

### P1 (中优先级)
- [ ] 分组/标签管理
- [ ] 自动重连
- [ ] 连接配置导入/导出
- [ ] 连接历史记录

### P2 (低优先级)
- [ ] 批量操作
- [ ] 心跳检测
- [ ] 性能监控面板
- [ ] 流量统计图表

---

## 9. 待确认事项

- [ ] 是否需要支持 TLS/SSL 加密连接
- [ ] 是否需要支持 Unix Socket 连接
- [ ] 连接配置是否需要加密存储
- [ ] 最大连接数限制
